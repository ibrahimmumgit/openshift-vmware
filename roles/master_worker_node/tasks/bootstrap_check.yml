---
- name: Wait for bootstrap to complete prior to starting workers
  command: "{{ openshift_working_directory_path }}/bin/openshift-install --dir={{ openshift_working_directory_path }}/install-dir wait-for bootstrap-complete --log-level debug" # noqa 301
  retries: 5
  delay: 10
  register: result_bootstrap
  until: result_bootstrap.rc == 0

    
- name: Copy comment proxy
  template:
    src: "comment_proxy.cfg.j2"
    dest: "/etc/haproxy/haproxy.cfg"
    mode: '0664'    
    
- name: Restart the haproxy
  command: "systemctl restart haproxy.service" 
    
- name: Power-On the worker VMs
  vmware_guest:
    hostname: "{{ vcenter.host }}"
    username: "{{ vcenter.username }}"
    password: "{{ vcenter.password }}"
    datacenter: "{{ vcenter.datacenter }}"
    validate_certs: no
    folder: "{{ vcenter.folder }}"
    name: "{{ item.name }}"
    state: poweredon
  loop: "{{ worker_nodes_list | default([]) }}"
  loop_control:
    label: "Power On {{ item.name }}"
